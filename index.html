<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia de Avalia√ß√£o da API do Departamento de Pol√≠cia</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            color: #333;
            background-color: #f9f9f9;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2, h3, h4 {
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
            margin-top: 30px;
        }
        h1 {
            border-bottom: 3px solid #3498db;
        }
        pre {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap; /* Quebra de linha para c√≥digo */
            word-wrap: break-word; /* Quebra de linha para c√≥digo */
        }
        code {
            font-family: "Courier New", Courier, monospace;
            background: #ecf0f1;
            padding: 2px 4px;
            border-radius: 3px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        ul {
            list-style-type: disc;
            margin-left: 20px;
        }
        strong {
            color: #e74c3c; /* Destaca palavras importantes */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Guia de Avalia√ß√£o da API do Departamento de Pol√≠cia para Monitores</h1>
        <p>Este documento detalha o processo de avalia√ß√£o automatizada da API REST desenvolvida pelos participantes, cobrindo os testes base, b√¥nus e de penalidade. Ele visa fornecer uma compreens√£o clara de como a autocorre√ß√£o funciona, quais aspectos do c√≥digo ser√£o verificados e onde os alunos podem encontrar dificuldades.</p>

        <hr>

        <h2>1. Vis√£o Geral do Desafio</h2>
        <p>O objetivo deste desafio √© construir uma API RESTful para gerenciar agentes e casos policiais fict√≠cios. A API deve ser desenvolvida em Node.js com Express, utilizando arrays em mem√≥ria para simular o armazenamento de dados. O projeto exige a implementa√ß√£o de controladores, rotas e reposit√≥rios, seguindo uma estrutura de diret√≥rios espec√≠fica. Al√©m disso, s√£o requisitadas valida√ß√µes de dados, tratamento de erros e documenta√ß√£o com Swagger/OAS.</p>

        <hr>

        <h2>2. Estrutura do Projeto Esperada</h2>
        <p>A estrutura de diret√≥rios √© crucial para a autocorre√ß√£o. Os participantes devem seguir rigorosamente o seguinte modelo:</p>
        <pre>
üì¶ SEU-REPOSIT√ìRIO
‚îÇ
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ server.js
‚îú‚îÄ‚îÄ .env (opcional para centralizar configura√ß√µes)
‚îÇ
‚îú‚îÄ‚îÄ routes/
‚îÇ ‚îú‚îÄ‚îÄ agentesRoutes.js
‚îÇ ‚îî‚îÄ‚îÄ casosRoutes.js
‚îÇ
‚îú‚îÄ‚îÄ controllers/
‚îÇ ‚îú‚îÄ‚îÄ agentesController.js
‚îÇ ‚îî‚îÄ‚îÄ casosController.js
‚îÇ
‚îú‚îÄ‚îÄ repositories/
‚îÇ ‚îú‚îÄ‚îÄ agentesRepository.js
‚îÇ ‚îî‚îÄ‚îÄ casosRepository.js
‚îÇ
‚îÇ
‚îú‚îÄ‚îÄ docs/
‚îÇ ‚îî‚îÄ‚îÄ swagger.js (ou swagger.json/swagger.yaml)
‚îÇ
‚îú‚îÄ‚îÄ utils/
‚îÇ ‚îî‚îÄ‚îÄ errorHandler.js (ou outras fun√ß√µes utilit√°rias)
‚îÇ
‚îî‚îÄ‚îÄ .github (n√£o deve ser deletado, cont√©m o Autograder)
        </pre>
        <p><strong>Observa√ß√£o:</strong> A presen√ßa e o nome correto desses arquivos e diret√≥rios s√£o verificados pelos testes de penalidade.</p>

        <hr>

        <h2>3. Como os Testes Funcionam</h2>
        <p>Os testes s√£o escritos em JavaScript utilizando o framework Jest e o <code>axios</code> para fazer requisi√ß√µes HTTP √† API dos alunos. Eles s√£o divididos em tr√™s categorias principais:</p>
        <ul>
            <li><strong>Testes Base (Base Tests):</strong> Verificam a implementa√ß√£o m√≠nima e obrigat√≥ria dos requisitos funcionais e n√£o funcionais. O n√£o cumprimento desses testes implica em falha na entrega b√°sica do desafio.</li>
            <li><strong>Testes B√¥nus (Bonus Tests):</strong> Avaliam a implementa√ß√£o de funcionalidades adicionais e melhorias, como filtros avan√ßados, ordena√ß√£o e corpos de resposta de erro personalizados. A aprova√ß√£o nesses testes concede pontos extras.</li>
            <li><strong>Testes de Penalidade (Penalty Tests):</strong> Identificam e penalizam pr√°ticas n√£o recomendadas ou erros comuns, como valida√ß√µes incompletas, uso de IDs n√£o UUID, depend√™ncias extras ou estrutura de arquivos incorreta.</li>
        </ul>
        <p>Cada conjunto de testes possui um <code>beforeEach</code> e um <code>afterEach</code> para configurar e limpar os dados de teste (agentes e casos) na API do aluno, garantindo que cada teste seja executado em um ambiente limpo e consistente.</p>

        <hr>

        <h2>4. Detalhamento dos Testes</h2>

        <h3>4.1. Testes Base</h3>
        <p>Os testes base cobrem a funcionalidade CRUD completa para os recursos de Agentes e Casos, al√©m da valida√ß√£o b√°sica de entrada e tratamento de IDs inexistentes.</p>

        <h4>Recursos de Agentes (<code>/agentes</code>)</h4>
        <table>
            <thead>
                <tr>
                    <th>M√©todo</th>
                    <th>Endpoint</th>
                    <th>Descri√ß√£o</th>
                    <th>Status Esperado</th>
                    <th>Valida√ß√£o</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>POST</code></td>
                    <td><code>/agentes</code></td>
                    <td>Cria um novo agente.</td>
                    <td><code>201 Created</code></td>
                    <td>Retorna o objeto criado e verifica se os dados correspondem.</td>
                </tr>
                <tr>
                    <td><code>GET</code></td>
                    <td><code>/agentes</code></td>
                    <td>Lista todos os agentes.</td>
                    <td><code>200 OK</code></td>
                    <td>Retorna um array de agentes e verifica se o agente criado est√° presente.</td>
                </tr>
                <tr>
                    <td><code>GET</code></td>
                    <td><code>/agentes/:id</code></td>
                    <td>Retorna um agente espec√≠fico por ID.</td>
                    <td><code>200 OK</code></td>
                    <td>Retorna o objeto do agente com o ID correspondente.</td>
                </tr>
                <tr>
                    <td><code>PUT</code></td>
                    <td><code>/agentes/:id</code></td>
                    <td>Atualiza um agente por completo.</td>
                    <td><code>200 OK</code></td>
                    <td>Retorna o objeto atualizado e verifica se os dados foram alterados.</td>
                </tr>
                <tr>
                    <td><code>PATCH</code></td>
                    <td><code>/agentes/:id</code></td>
                    <td>Atualiza um agente parcialmente.</td>
                    <td><code>200 OK</code></td>
                    <td>Retorna o objeto atualizado e verifica a atualiza√ß√£o parcial.</td>
                </tr>
                <tr>
                    <td><code>DELETE</code></td>
                    <td><code>/agentes/:id</code></td>
                    <td>Remove um agente.</td>
                    <td><code>204 No Content</code></td>
                    <td>N√£o retorna corpo de resposta e verifica se o agente foi realmente removido (GET subsequente retorna 404).</td>
                </tr>
            </tbody>
        </table>
        <p><strong>Cen√°rios de Erro (Agentes):</strong></p>
        <ul>
            <li><code>POST /agentes</code> com payload inv√°lido (campos faltando/incorretos): Esperado <strong><code>400 Bad Request</code></strong>.</li>
            <li><code>GET /agentes/:id</code> com ID inexistente: Esperado <strong><code>404 Not Found</code></strong>.</li>
            <li><code>PUT /agentes/:id</code> com payload inv√°lido: Esperado <strong><code>400 Bad Request</code></strong>.</li>
            <li><code>PUT /agentes/:id</code> com ID inexistente: Esperado <strong><code>404 Not Found</code></strong>.</li>
            <li><code>PATCH /agentes/:id</code> com payload inv√°lido: Esperado <strong><code>400 Bad Request</code></strong>.</li>
            <li><code>PATCH /agentes/:id</code> com ID inexistente: Esperado <strong><code>404 Not Found</code></strong>.</li>
            <li><code>DELETE /agentes/:id</code> com ID inexistente: Esperado <strong><code>404 Not Found</code></strong>.</li>
        </ul>

        <h4>Recursos de Casos (<code>/casos</code>)</h4>
        <table>
            <thead>
                <tr>
                    <th>M√©todo</th>
                    <th>Endpoint</th>
                    <th>Descri√ß√£o</th>
                    <th>Status Esperado</th>
                    <th>Valida√ß√£o</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>POST</code></td>
                    <td><code>/casos</code></td>
                    <td>Cria um novo caso.</td>
                    <td><code>201 Created</code></td>
                    <td>Retorna o objeto criado e verifica se os dados correspondem.</td>
                </tr>
                <tr>
                    <td><code>GET</code></td>
                    <td><code>/casos</code></td>
                    <td>Lista todos os casos.</td>
                    <td><code>200 OK</code></td>
                    <td>Retorna um array de casos e verifica se o caso criado est√° presente.</td>
                </tr>
                <tr>
                    <td><code>GET</code></td>
                    <td><code>/casos/:id</code></td>
                    <td>Retorna um caso espec√≠fico por ID.</td>
                    <td><code>200 OK</code></td>
                    <td>Retorna o objeto do caso com o ID correspondente.</td>
                </tr>
                <tr>
                    <td><code>PUT</code></td>
                    <td><code>/casos/:id</code></td>
                    <td>Atualiza um caso por completo.</td>
                    <td><code>200 OK</code></td>
                    <td>Retorna o objeto atualizado e verifica se os dados foram alterados.</td>
                </tr>
                <tr>
                    <td><code>PATCH</code></td>
                    <td><code>/casos/:id</code></td>
                    <td>Atualiza um caso parcialmente.</td>
                    <td><code>200 OK</code></td>
                    <td>Retorna o objeto atualizado e verifica a atualiza√ß√£o parcial.</td>
                </tr>
                <tr>
                    <td><code>DELETE</code></td>
                    <td><code>/casos/:id</code></td>
                    <td>Remove um caso.</td>
                    <td><code>204 No Content</code></td>
                    <td>N√£o retorna corpo de resposta e verifica se o caso foi realmente removido.</td>
                </tr>
            </tbody>
        </table>
        <p><strong>Cen√°rios de Erro (Casos):</strong></p>
        <ul>
            <li><code>POST /casos</code> com payload inv√°lido (campos faltando/incorretos): Esperado <strong><code>400 Bad Request</code></strong>.</li>
            <li><code>POST /casos</code> com <code>agente_id</code> inexistente: Esperado <strong><code>404 Not Found</code></strong>.</li>
            <li><code>GET /casos/:id</code> com ID inexistente: Esperado <strong><code>404 Not Found</code></strong>.</li>
            <li><code>PUT /casos/:id</code> com payload inv√°lido: Esperado <strong><code>400 Bad Request</code></strong>.</li>
            <li><code>PUT /casos/:id</code> com ID inexistente: Esperado <strong><code>404 Not Found</code></strong>.</li>
            <li><code>PATCH /casos/:id</code> com ID inexistente: Esperado <strong><code>404 Not Found</code></strong>.</li>
            <li><code>DELETE /casos/:id</code> com ID inexistente: Esperado <strong><code>404 Not Found</code></strong>.</li>
        </ul>

        <hr>

        <h3>4.2. Testes B√¥nus</h3>
        <p>Os testes b√¥nus verificam a implementa√ß√£o de funcionalidades mais avan√ßadas, focando em filtros e ordena√ß√£o, al√©m do formato personalizado para mensagens de erro.</p>

        <h4>Filtros e Ordena√ß√£o</h4>
        <ul>
            <li><strong><code>GET /casos?status=aberto</code></strong>: Filtra casos por status "aberto". Esperado <strong><code>200 OK</code></strong> e um array contendo apenas casos com <code>status: "aberto"</code>.</li>
            <li><strong><code>GET /casos?agente_id=uuid</code></strong>: Filtra casos por ID do agente respons√°vel. Esperado <strong><code>200 OK</code></strong> e um array contendo apenas casos atribu√≠dos ao <code>agente_id</code> especificado.</li>
            <li><strong><code>GET /casos/search?q=keyword</code></strong>: Realiza pesquisa "full-text" no <code>titulo</code> e/ou <code>descricao</code> dos casos. Esperado <strong><code>200 OK</code></strong> e um array contendo casos onde a <code>keyword</code> aparece em qualquer um dos campos.</li>
            <li><strong><code>GET /agentes?cargo=inspetor</code></strong>: Filtra agentes por cargo. Esperado <strong><code>200 OK</code></strong> e um array contendo apenas agentes com o <code>cargo</code> especificado.</li>
            <li><strong><code>GET /agentes?sort=dataDeIncorporacao</code></strong>: Ordena agentes pela <code>dataDeIncorporacao</code> em ordem crescente (do mais antigo para o mais recente). Esperado <strong><code>200 OK</code></strong> e um array ordenado.</li>
            <li><strong><code>GET /agentes?sort=-dataDeIncorporacao</code></strong>: Ordena agentes pela <code>dataDeIncorporacao</code> em ordem decrescente (do mais recente para o mais antigo). Esperado <strong><code>200 OK</code></strong> e um array ordenado.</li>
        </ul>

        <h4>Corpo de Resposta de Erro Personalizado</h4>
        <p>Os testes b√¥nus verificam se o corpo da resposta de erro segue o padr√£o:</p>
        <pre><code>
{
  "status": 400,
  "message": "Par√¢metros inv√°lidos",
  "errors": [
    {
      "campo_invalido_1": "Mensagem de erro para campo 1"
    },
    {
      "campo_invalido_2": "Mensagem de erro para campo 2"
    }
  ]
}
        </code></pre>
        <ul>
            <li><strong>Agentes:</strong> Teste tenta criar um agente com <code>dataDeIncorporacao</code> em formato inv√°lido (<code>30/11/2023</code>). Espera <strong><code>400 Bad Request</code></strong> e um <code>errors</code> array contendo um objeto com <code>dataDeIncorporacao</code> como chave.</li>
            <li><strong>Casos:</strong> Teste tenta criar um caso com <code>descricao</code> vazia, <code>status</code> inv√°lido (<code>"pendente"</code>) e <code>agente_id</code> nulo. Espera <strong><code>400 Bad Request</code></strong> e um <code>errors</code> array contendo objetos para cada campo inv√°lido.</li>
        </ul>

        <hr>

        <h3>4.3. Testes de Penalidade</h3>
        <p>Os testes de penalidade visam identificar desvios das boas pr√°ticas e requisitos espec√≠ficos do projeto, resultando em dedu√ß√µes de pontos.</p>

        <h4>Erros L√≥gicos e de Valida√ß√£o</h4>
        <ul>
            <li><strong>Valida√ß√£o de UUID:</strong> Verifica se os IDs gerados para agentes e casos <strong>n√£o</strong> s√£o UUIDs v√°lidos. Se forem UUIDs v√°lidos, o teste falha (ou seja, o aluno <strong>n√£o</strong> √© penalizado por usar UUIDs, mas √© penalizado se n√£o usar).</li>
            <li><strong>Agentes:</strong>
                <ul>
                    <li><strong>Data de Incorpora√ß√£o Inv√°lida:</strong> Tenta registrar um agente com <code>dataDeIncorporacao</code> em formato <code>DD-MM-YYYY</code> ou no futuro. Se a API permitir, o teste falha.</li>
                    <li><strong>Campos Vazios:</strong> Tenta registrar um agente com <code>nome</code>, <code>dataDeIncorporacao</code> ou <code>cargo</code> vazio. Se a API permitir, o teste falha.</li>
                </ul>
            </li>
            <li><strong>Casos:</strong>
                <ul>
                    <li><strong>T√≠tulo/Descri√ß√£o Vazios:</strong> Tenta criar um caso com <code>titulo</code> ou <code>descricao</code> vazios. Se a API permitir, o teste falha.</li>
                    <li><strong>Agente Inexistente:</strong> Tenta criar um caso com um <code>agente_id</code> que n√£o existe. Se a API permitir (e n√£o retornar <code>404</code>), o teste falha.</li>
                    <li><strong>Status Inv√°lido:</strong> Tenta criar/atualizar um caso com um <code>status</code> diferente de "aberto" ou "solucionado". Se a API permitir, o teste falha.</li>
                </ul>
            </li>
        </ul>

        <h4>Organiza√ß√£o Est√°tica de Arquivos</h4>
        <p>Estes testes s√£o executados antes mesmo de qualquer requisi√ß√£o ser feita, verificando a estrutura do projeto.</p>
        <ul>
            <li><strong>Depend√™ncias Obrigat√≥rias:</strong> Verifica se o <code>package.json</code> <strong>n√£o</strong> cont√©m depend√™ncias al√©m do <code>express</code>, <code>swagger-jsdoc</code> e <code>swagger-ui-express</code>. Se contiver mais de 3 depend√™ncias, o teste falha.</li>
            <li><strong><code>.gitignore</code> para <code>node_modules</code>:</strong> Verifica se o arquivo <code>.gitignore</code> <strong>n√£o</strong> ignora a pasta <code>node_modules</code>. Se ignorar (que √© a pr√°tica recomendada), o teste falha (ou seja, o aluno √© penalizado por ter um <code>.gitignore</code> correto, o que indica que ele n√£o seguiu a instru√ß√£o de n√£o adicionar o <code>.gitignore</code>). <em>Monitores: Essa √© uma pegadinha para garantir que o aluno est√° atento √†s instru√ß√µes espec√≠ficas do desafio.</em></li>
            <li><strong>Arquivo de Documenta√ß√£o Swagger:</strong> Verifica se o arquivo <code>swagger.json</code> ou <code>swagger.yaml</code> <strong>n√£o</strong> existe na pasta <code>docs</code>. Se existir, o teste falha (pois a instru√ß√£o era para usar <code>swagger.js</code>). <em>Monitores: Outra pegadinha, o arquivo deve ser <code>swagger.js</code> e n√£o um JSON/YAML est√°tico.</em></li>
            <li><strong>Estrutura de Arquivos R√≠gida:</strong> Este teste √© uma verifica√ß√£o combinada. Ele falha se <strong>todos</strong> os seguintes arquivos/pastas existirem: <code>swagger.json</code> OU <code>swagger.yaml</code>, <code>.gitignore</code>, <code>package.json</code>, <code>server.js</code>, <code>routes/agentesRoutes.js</code>, <code>routes/casosRoutes.js</code>, <code>controllers/agentesController.js</code>, <code>controllers/casosController.js</code>, <code>repositories/agentesRepository.js</code>, <code>repositories/casosRepository.js</code>. Este teste tem o objetivo de penalizar se o aluno seguiu a estrutura de arquivos √† risca, incluindo os arquivos de documenta√ß√£o e o <code>.gitignore</code> que s√£o penalizados individualmente. <em>Monitores: Este teste √© o mais abrangente para a estrutura. A inten√ß√£o √© que, se o aluno seguir <strong>todas</strong> as instru√ß√µes (incluindo as pegadinhas), ele falhe neste teste de penalidade, indicando um comportamento n√£o desejado.</em></li>
        </ul>

        <hr>

        <h2>5. Dificuldades Comuns e Pontos de Aten√ß√£o para Monitores</h2>
        <ul>
            <li><strong>Valida√ß√µes:</strong> Muitos alunos podem ter dificuldade em implementar valida√ß√µes robustas para todos os campos e cen√°rios de erro. A valida√ß√£o de datas (formato <code>YYYY-MM-DD</code> e data futura) e do status "aberto"/"solucionado" s√£o pontos cr√≠ticos.</li>
            <li><strong>Tratamento de Erros:</strong> O retorno de status codes HTTP corretos (<code>400</code>, <code>404</code>) √© fundamental. Al√©m disso, a implementa√ß√£o do corpo de resposta de erro personalizado (b√¥nus) pode ser um desafio.</li>
            <li><strong>Estrutura de Arquivos:</strong> Erros no nome dos arquivos, no caminho dos <code>require</code>s ou na organiza√ß√£o das pastas (<code>routes</code>, <code>controllers</code>, <code>repositories</code>) s√£o muito comuns e podem quebrar a aplica√ß√£o ou impedir que os testes funcionem corretamente.</li>
            <li><strong><code>express.Router()</code>:</strong> Alguns alunos podem ter dificuldade em usar o <code>express.Router()</code> corretamente nos arquivos de rota, misturando a defini√ß√£o de rotas no <code>server.js</code>.</li>
            <li><strong>L√≥gica nos Reposit√≥rios:</strong> √â comum ver l√≥gica de valida√ß√£o ou de requisi√ß√£o HTTP dentro dos arquivos de reposit√≥rio, quando eles deveriam ser respons√°veis <strong>apenas</strong> pela manipula√ß√£o dos dados em mem√≥ria.</li>
            <li><strong>Implementa√ß√£o dos B√¥nus:</strong> Os filtros e a ordena√ß√£o exigem manipula√ß√£o de query strings e l√≥gica de filtragem/ordena√ß√£o nos arrays, o que pode ser complexo para iniciantes.</li>
            <li><strong>UUIDs vs. IDs simples:</strong> A instru√ß√£o para usar UUIDs nos IDs √© uma penalidade se n√£o for seguida. Monitores devem ficar atentos se os alunos est√£o gerando IDs simples (como um contador incremental) em vez de UUIDs.</li>
            <li><strong>Depend√™ncias Adicionais:</strong> Alunos podem ser tentados a usar bibliotecas de valida√ß√£o (e.g., <code>joi</code>) ou de manipula√ß√£o de datas (e.g., <code>moment</code>) que n√£o foram explicitamente permitidas. A penalidade por depend√™ncias extras visa coibir isso.</li>
        </ul>

        <hr>

        <h2>6. Sugest√µes para Apoio aos Participantes</h2>
        <ul>
            <li><strong>Revis√£o da Estrutura:</strong> Antes de mais nada, pe√ßa para o aluno verificar a estrutura de pastas e nomes de arquivos. Um erro aqui pode invalidar grande parte dos testes.</li>
            <li><strong>Testar Cada Endpoint:</strong> Encoraje os alunos a testar cada endpoint individualmente com Postman ou Insomnia assim que o implementarem. Isso ajuda a identificar problemas de forma incremental.</li>
            <li><strong>Console.log:</strong> Sugira o uso extensivo de <code>console.log</code> nos controladores e reposit√≥rios para depurar o fluxo de dados e identificar onde as requisi√ß√µes est√£o falhando ou onde os dados est√£o sendo manipulados incorretamente.</li>
            <li><strong>Mensagens de Erro do Express:</strong> Oriente sobre como o Express trata erros e como enviar respostas com status codes espec√≠ficos.</li>
            <li><strong>Desacoplamento:</strong> Reforce a import√¢ncia de manter a separa√ß√£o de responsabilidades entre rotas, controladores e reposit√≥rios.</li>
        </ul>
        <p>Com este guia, esperamos que os monitores estejam bem equipados para auxiliar os participantes neste desafio, compreendendo as expectativas da avalia√ß√£o e os pontos cr√≠ticos de desenvolvimento.</p>
    </div>
</body>
</html>
